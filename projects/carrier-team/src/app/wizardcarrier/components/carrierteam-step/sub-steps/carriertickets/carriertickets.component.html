<div
  class="toast"
  *ngIf="toastVisible"
  [ngClass]="{
    visible: toastVisible,
    'toast-success': toastType === 'success',
    'toast-error': toastType === 'error',
    'toast-warning': toastType === 'warning'
  }"
>
  <div class="toast-content">
    <span class="toast-message">{{ toastMessage }}</span>
    <button class="close-toast" (click)="hideToast()">Ã—</button>
  </div>
</div>

<div *ngIf="isLoading">Loading data...</div>
<div *ngIf="isLoading" class="skeleton-loader skeleton-loader-table"></div>

<div class="row">
  <div class="col-md-9 mb-3">
    <p *ngIf="!isLoading" class="lead">Administering unassigned carriers tickets</p>

    <hr />

    <div>
      <!-- Unassigned tickets by tier breakdown -->

      <div
        class="list-group-bullet li"
        style="font-weight: 600;color:black"
        *ngIf="!isLoading && unassignedTickets.length > 0"
      >
        <li>T1: {{ unassignedTier1Count }}</li>
        <li>T2: {{ unassignedTier2Count }}</li>
        <li>T3: {{ unassignedTier3Count }}</li>
        <li>Total Unassigned Tickets: {{ totalUnassignedCount }}</li>

        <button
          *ngIf="unassignedTickets.length > 0 && !isLoading"
          class="btn btn-primary btn-sm"
          (click)="syncAllUnassignedTickets()"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            style="width: 1.5rem; height: 1.5rem;"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-5.25h5.25M7.5 15h3M3.375 5.25c-.621 0-1.125.504-1.125 1.125v3.026a2.999 2.999 0 0 1 0 5.198v3.026c0 .621.504 1.125 1.125 1.125h17.25c.621 0 1.125-.504 1.125-1.125v-3.026a2.999 2.999 0 0 1 0-5.198V6.375c0-.621-.504-1.125-1.125-1.125H3.375Z"
            />
          </svg>

          Auto-assign tickets
        </button>
        <button
          *ngIf="unassignedTickets.length > 0 && !isLoading"
          class="btn btn-info btn-sm ml-1"
          (click)="analyzeTicketsForCarrierID()"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            style="width: 1.5rem; height: 1.5rem;"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0Z"
            />
          </svg>
          Auto-detect carriers
        </button>
      </div>

      <div *ngIf="isLoading" class="skeleton-loader skeleton-loader-table"></div>

      <table class="table table-responsive-xl" *ngIf="unassignedTickets.length > 0 && !isLoading">
        <thead>
          <tr>
            <th>Ticket ID</th>
            <th>Subject</th>
            <th>Created</th>
            <th>Updated</th>
            <th>Tier</th>
            <th>Carrier</th>
            <!-- New column for assigned member -->
            <th>Carrier ID</th>
            <th>Priority</th>
            <!-- New column for Priority -->
            <th>Carrier CIS</th>
            <!-- New column for assigned member -->
            <th>Asignee Ticket</th>
            <!-- New column for assigned member -->
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ticket of unassignedTickets">
            <td>
              <a [href]="'https://nshift.zendesk.com/agent/tickets/' + ticket.ticket_id" target="_blank">
                {{ ticket.ticket_id }}
              </a>
            </td>
            <td>{{ ticket.subject }}</td>
            <td>{{ ticket.created_at }}</td>
            <td>{{ ticket.updated_at }}</td>
            <td>{{ ticket.tier | titlecase }}</td>
            <td>{{ ticket.carrierName }}</td>
            <!-- Display Carrier Name -->
            <td>{{ ticket.carrier_id }}</td>
            <td>{{ ticket.priority | titlecase }}</td>
            <!-- Display Priority -->
            <td>{{ ticket.assigned_to }}</td>
            <!-- Display assigned member -->
            <td>
              <select
                class="form-control"
                (change)="updateTicketAssignee(ticket.ticket_id, getSelectValue($event))"
                [value]="ticket.assigned_to || ''"
              >
                <option *ngFor="let member of members" [value]="member.zendeskID">
                  {{ member.name }}
                </option>
              </select>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <hr />
  </div>
</div>
